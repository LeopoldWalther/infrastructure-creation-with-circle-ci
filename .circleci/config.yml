version: 2.1

orbs:

jobs:
  create_infrastructure:
    docker:
      - image: amazon/aws-cli
    steps:
      - checkout # check out the code in the project directory
      - run: 
        name: Create Cloudformation Stack
        command: | 
          aws cloudformation create-stack \
          --stack-name infra \
          --template-body infrastructure.yml  \
          --parameters infrastructure-parameters.json \
          --capabilities "CAPABILITY_IAM" "CAPABILITY_NAMED_IAM" \
          --region=us-east-1


workflows:
  myWorkflow:
    jobs:
      - create_infrastructure